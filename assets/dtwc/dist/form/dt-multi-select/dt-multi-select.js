import{s as t,r as e,$ as i}from"../../lit-element-36d48372.js";import"../../icons/dt-spinner.js";import"../../icons/dt-checkmark.js";class o extends t{static get styles(){return e`:host{position:relative;--borderWidth:3px;--borderColor:#78b13f;color:var(--dt-multi-select-text-color,#555);position:relative;font-family:Helvetica,Arial,sans-serif}.field-container{background-color:#fefefe;border:1px solid var(--dt-component-border-color,#cacaca);border-radius:0;color:#0a0a0a;font-size:1rem;font-weight:300;min-height:2.5rem;line-height:1.5;margin:0 0 1.0666666667rem;padding:.5333333333rem 1.6rem .5333333333rem .5333333333rem;-webkit-box-sizing:border-box;box-sizing:border-box;width:100%;text-transform:none;display:flex;flex-wrap:wrap}.selected-option{border:1px solid var(--dt-multi-select-tag-border-color,#c2e0ff);background-color:var(--dt-multi-select-tag-bkrd-color,#ecf5fc);display:flex;font-size:.875rem;position:relative;padding-left:4px;border-radius:2px;margin-right:4px;margin-bottom:.375rem}.selected-option *{align-self:center}.selected-option button{background:0 0;outline:0;border:0;border-left:1px solid var(--dt-multi-select-tag-border-color,#c2e0ff);margin-left:4px}.selected-option button:hover{cursor:pointer}.field-container input{flex-grow:1;min-width:50px;border:0}.field-container input:active,.field-container input:focus,.field-container input:focus-visible{border:0;outline:0}.option-list{list-style:none;margin:0;padding:0;border:1px solid var(--dt-component-border-color,#cacaca);background:#fff;z-index:10;position:absolute;width:100%;top:0;left:0;box-shadow:0 5px 10px 0;max-height:150px;overflow-y:scroll}.option-list li{border-top:1px solid var(--dt-component-border-color,#cacaca);outline:0}.option-list li button,.option-list li div{padding:.5rem .75rem;color:#333;font-weight:100;font-size:1rem;text-decoration:none;text-align:inherit}.option-list li button{display:block;width:100%;border:0;background:0 0}.option-list li button.active,.option-list li button:hover{cursor:pointer;background:var(--dt-multi-select-option-hover-bkrd,#f5f5f5)}.icon-overlay{position:absolute;right:2rem;top:0;height:100%;display:flex;justify-content:center;align-items:center}`}static get properties(){return{name:{type:String},placeholder:{type:String},options:{type:Array},filteredOptions:{type:Array,state:!0},value:{type:Array,reflect:!0},open:{type:Boolean,state:!0},query:{type:String,state:!0},activeIndex:{type:Number,state:!0},containerHeight:{type:Number,state:!0},loading:{type:Boolean},saved:{type:Boolean},onchange:{type:String}}}constructor(){super(),this.activeIndex=-1,this.filteredOptions=[]}firstUpdated(){this._filterOptions()}updated(){this.shadowRoot.children&&this.shadowRoot.children.length&&(this.containerHeight=this.shadowRoot.children[0].offsetHeight),this._scrollOptionListToActive()}_scrollOptionListToActive(){const t=this.shadowRoot.querySelector(".option-list"),e=this.shadowRoot.querySelector("button.active");if(t&&e){const i=e.offsetTop,o=e.offsetTop+e.clientHeight,s=t.scrollTop;o>t.scrollTop+t.clientHeight?t.scrollTo({top:o-t.clientHeight,behavior:"smooth"}):i<s&&t.scrollTo({top:i,behavior:"smooth"})}}_clickOption(t){t.target&&t.target.value&&this._select(t.target.value)}_keyboardSelectOption(){this.activeIndex>-1&&this._select(this.filteredOptions[this.activeIndex].id)}_select(t){const e=new CustomEvent("change",{detail:{field:this.name,oldValue:this.value,newValue:t}});this.value&&this.value.length?this.value=[...this.value,t]:this.value=[t],this.open=!1,this.activeIndex=-1,this.dispatchEvent(e)}_remove(t){t.target&&t.target.dataset&&t.target.dataset.value&&(this.value=(this.value||[]).filter((e=>e!==t.target.dataset.value)))}static _focusInput(t){t.target===t.currentTarget&&t.target.getElementsByTagName("input")[0].focus()}_inputFocusIn(){this.open=!0,this.activeIndex=-1}_inputFocusOut(t){t.relatedTarget&&"BUTTON"===t.relatedTarget.nodeName||(this.open=!1)}_inputKeyDown(t){switch(t.keyCode||t.which){case 8:""===t.target.value&&(this.value=this.value.slice(0,-1));break;case 38:this.open=!0,this._listHighlightPrevious();break;case 40:this.open=!0,this._listHighlightNext();break;case 13:case 9:this._keyboardSelectOption();break;case 27:this.open=!1,this.activeIndex=-1;break;default:this.open=!0}}_inputKeyUp(t){this.query=t.target.value;const e=t.keyCode||t.which;[9,13,38,40].includes(e)||this._filterOptions()}_listHighlightNext(){this.activeIndex=Math.min(this.filteredOptions.length-1,this.activeIndex+1)}_listHighlightPrevious(){this.activeIndex=Math.max(0,this.activeIndex-1)}_filterOptions(){return this.filteredOptions=(this.options||[]).filter((t=>!(this.value||[]).includes(t.id)&&(!this.query||t.label.toLocaleLowerCase().includes(this.query.toLocaleLowerCase())))),this.filteredOptions}_renderSelectedOptions(){return this.options&&this.options.filter((t=>this.value&&this.value.indexOf(t.id)>-1)).map((t=>i`<div class="selected-option"><span>${t.label}</span> <button @click="${this._remove}" data-value="${t.id}">x</button></div>`))}_renderOptions(){return this.filteredOptions.length?this.filteredOptions.map(((t,e)=>i`<li><button value="${t.id}" data-label="${t.label}" @click="${this._clickOption}" class="${this.activeIndex>-1&&this.activeIndex===e?"active":null}">${t.label}</button></li>`)):i`<li><div>No options available</div></li>`}render(){return i`<div class="field-container" @click="${this._focusInput}" @keydown="${this._focusInput}">${this._renderSelectedOptions()} <input type="text" placeholder="${this.placeholder}" @focusin="${this._inputFocusIn}" @focusout="${this._inputFocusOut}" @keydown="${this._inputKeyDown}" @keyup="${this._inputKeyUp}"></div><ul class="option-list" style="display:${this.open?"block":"none"};top:${this.containerHeight}">${this._renderOptions()}</ul>${this.loading?i`<dt-spinner class="icon-overlay"></dt-spinner>`:null} ${this.saved?i`<dt-checkmark class="icon-overlay"></dt-checkmark>`:null}`}}window.customElements.define("dt-multi-select",o);export{o as D};
