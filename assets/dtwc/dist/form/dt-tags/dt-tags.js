import{$ as t}from"../../lit-element-36d48372.js";import{D as e}from"../dt-multi-select/dt-multi-select.js";import"../../icons/dt-spinner.js";import"../../icons/dt-checkmark.js";window.customElements.define("dt-tags",class extends e{static get properties(){return{...super.properties,allowAdd:{type:Boolean},onload:{type:String}}}firstUpdated(){this._filterOptions()}_clickOption(t){t.target&&t.target.value&&(this._select({id:t.target.value,label:t.target.dataset?.label}),this._filterOptions())}_clickAddNew(t){t.target&&this._select({id:"",label:t.target.dataset?.label})}_remove(t){t.target&&t.target.dataset&&t.target.dataset.value&&(this.value=(this.value||[]).filter((e=>e.id!==t.target.dataset.value)))}_keyboardSelectOption(){this.activeIndex>-1&&(this.activeIndex+1>this.filteredOptions.length?this._select({id:"",label:this.query}):this._select(this.filteredOptions[this.activeIndex]),this._filterOptions())}_listHighlightNext(){this.activeIndex=Math.min(this.filteredOptions.length,this.activeIndex+1)}_filterOptions(){const t=(this.value||[]).map((t=>t?.id));if(this.options?.length)this.filteredOptions=(this.options||[]).filter((e=>!t.includes(e.id)&&(!this.query||e.label.toLocaleLowerCase().includes(this.query.toLocaleLowerCase()))));else{this.loading=!0,this.filteredOptions=[];const e=this,i=new CustomEvent("load",{detail:{field:this.name,query:this.query,onSuccess:i=>{e.loading=!1,e.filteredOptions=i.filter((e=>!t.includes(e.id)))},onError:t=>{console.log(t),e.loading=!1}}});this.dispatchEvent(i)}return this.filteredOptions}_renderOptions(){let e=super._renderOptions();return this.allowAdd&&this.query&&(Array.isArray(e)||(e=[e]),e.push(t`<li><button data-label="${this.query}" @click="${this._clickAddNew}" class="${this.activeIndex>-1&&this.activeIndex>=this.filteredOptions.length?"active":null}">Add "${this.query}"</button></li>`)),e}_renderSelectedOptions(){return(this.value||[]).map((e=>t`<div class="selected-option"><span>${e.label}</span> <button @click="${this._remove}" data-value="${e.id}">x</button></div>`))}});
